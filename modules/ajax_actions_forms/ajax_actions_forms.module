<?php

function ajax_actions_node_add_form($type) {
  return array(
    'op' => 'node_add_form',
    'type' => $type,
  );
}

function ajax_actions_forms_ajax_actions_commands(&$action, &$options) {
  if ($action['op'] == 'node_add_form') {
    global $user;
    
    $type = $action['type'];
    $form_id = $type . '_node_form';

    $node = (object) array(
      'uid' => $user->uid,
      'name' => (isset($user->name) ? $user->name : ''),
      'type' => $type,
      'language' => LANGUAGE_NONE,
    );
    
    $form_state['build_info']['args']['node'] = $node;
    $form_state['cache'] = true;
    $form_state['build_info']['files'][] = array('type' => 'inc', 'module' => 'node', 'name' => 'node.pages');
    
    module_load_include('inc', 'node', 'node.pages');
    
    $form = drupal_build_form($form_id, $form_state);
    
    $action['commands'][] = ajax_command_pp_popup(render($form));
  }
}